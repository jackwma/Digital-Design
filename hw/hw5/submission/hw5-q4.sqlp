/* Wenjie Ma CSE 414
   Dan Suciu 
   Homework 5 Problem 4 */

use hw5;
select e.`#text` as ethnic_group, count(e) as num_countries, sum(int(c.population)*float(e.`-percentage`)/100) as total_population
from world as w, w.mondial.country as c, 
	case when c.ethnicgroups is missing then []
	when is_array(c.ethnicgroups) then c.ethnicgroups
	else [c.ethnicgroups] end as e
group by e.`#text`;

--Duration of all jobs: 0.374 sec

